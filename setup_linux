#!/usr/bin/env bash
set -e

echo "Setting up Linux"

# Determine if we need sudo or if it's available
SUDO=""
if [ "$EUID" -ne 0 ]; then
    if command -v sudo >/dev/null 2>&1; then
        SUDO="sudo"
        echo "Using sudo for elevated privileges"
    else
        echo "Warning: Not running as root and sudo not available."
        echo "Please run as root or install sudo."
        exit 1
    fi
else
    echo "Running as root, sudo not needed"
fi

$SUDO apt update -y
$SUDO apt upgrade -y

# Install dependencies
$SUDO apt install -y \
    zsh \
    vim \
    curl \
    git \
    ruby \
    ruby-dev \
    bat \
    fzf \
    direnv \
    build-essential \
    software-properties-common

# Install Starship
if ! command -v starship >/dev/null 2>&1; then
    echo "Installing Starship..."
    $SUDO /bin/sh starship/install.sh -y
fi

# Change shell to zsh
if [ "$SHELL" != "$(which zsh)" ]; then
    echo "Changing shell to zsh..."
    chsh -s "$(which zsh)"
fi

# Install colorls
echo "Installing colorls..."
$SUDO gem install colorls

# Firacode
echo "Installing FiraCode fonts..."
$SUDO add-apt-repository -y universe
$SUDO apt update -y
$SUDO apt install -y fonts-firacode
